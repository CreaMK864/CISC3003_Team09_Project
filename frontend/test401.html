<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Chatbot</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #5D5CDE;
      --bg-light: #FFFFFF;
      --bg-dark: #181818;
      --text-light: #333333;
      --text-dark: #F0F0F0;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: background-color 0.3s, color 0.3s;
    }
    
    .dark body {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }
    
    .container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    
    .sidebar {
      width: 250px;
      background-color: #f5f5f5;
      padding: 20px;
      transition: transform 0.3s ease;
    }
    
    .dark .sidebar {
      background-color: #222;
    }
    
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-left: 1px solid #ddd;
    }
    
    .dark .chat-container {
      border-left: 1px solid #444;
    }
    
    .chat-header {
      padding: 15px;
      background-color: #fff;
      border-bottom: 1px solid #ddd;
    }
    
    .dark .chat-header {
      background-color: #333;
      border-bottom: 1px solid #444;
    }
    
    .chat-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .message {
      padding: 10px 15px;
      border-radius: 10px;
      max-width: 70%;
      word-break: break-word;
    }
    
    .user-message {
      align-self: flex-end;
      background-color: var(--primary-color);
      color: white;
    }
    
    .bot-message {
      align-self: flex-start;
      background-color: #f0f0f0;
      color: #333;
    }
    
    .dark .bot-message {
      background-color: #444;
      color: #f0f0f0;
    }
    
    .error-message {
      align-self: center;
      background-color: #ffdddd;
      color: #d00;
      padding: 10px 15px;
      border-radius: 5px;
      margin: 10px 0;
    }
    
    .dark .error-message {
      background-color: #500;
      color: #ffdddd;
    }
    
    .chat-input {
      padding: 15px;
      background-color: #fff;
      border-top: 1px solid #ddd;
    }
    
    .dark .chat-input {
      background-color: #333;
      border-top: 1px solid #444;
    }
    
    .chat-input form {
      display: flex;
      gap: 10px;
    }
    
    .chat-input input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    
    .dark .chat-input input {
      border: 1px solid #555;
      background-color: #444;
      color: #f0f0f0;
    }
    
    .chat-input button {
      padding: 10px 20px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    
    .typing-indicator {
      display: flex;
      gap: 5px;
      padding: 5px 10px;
    }
    
    .typing-indicator span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #aaa;
      animation: typing 1.3s ease-in-out infinite;
    }
    
    .typing-indicator span:nth-child(2) {
      animation-delay: 0.15s;
    }
    
    .typing-indicator span:nth-child(3) {
      animation-delay: 0.3s;
    }
    
    @keyframes typing {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        z-index: 100;
        transform: translateX(-100%);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .hamburger {
        display: block;
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 101;
        padding: 10px;
        background-color: #5D5CDE;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="user-info">
        <h2>My Chatbot</h2>
        <div id="user-email" class="user-email"></div>
      </div>
      <ul class="mt-6 space-y-2">
        <li><a href="#" class="active block py-2 px-4 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Home</a></li>
        <li><a href="#" class="block py-2 px-4 rounded hover:bg-gray-200 dark:hover:bg-gray-700">History</a></li>
        <li><a href="#" class="block py-2 px-4 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Profile</a></li>
        <li><a href="#" class="block py-2 px-4 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Settings</a></li>
      </ul>
      <!-- Auth block -->
      <div class="auth-block mt-6" id="auth_reg">
        <h3 class="text-lg font-semibold">Get Started</h3>
        <p class="text-sm text-gray-600 dark:text-gray-400">Sign in to save your conversations</p>
        <div class="auth-buttons flex gap-2 mt-3">
          <button class="auth-button bg-primary-color text-white px-4 py-2 rounded">Login</button>
          <button class="auth-button bg-gray-200 dark:bg-gray-700 px-4 py-2 rounded">Register</button>
        </div>
      </div>
      <div class="auth-block mt-6 hidden" id="auth_logout">
        <div class="logout-section">
          <button id="logout-button" class="auth-button bg-red-500 text-white px-4 py-2 rounded">Sign Out</button>
        </div>
      </div>
      <div id="alert_msg" class="mt-4 p-3 bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100 rounded">
        Please log in to save your chat history
      </div>
    </div>

    <!-- Chat container -->
    <div class="chat-container">
      <div class="chat-header">
        <h2 class="text-xl font-semibold">My AI Assistant</h2>
      </div>
      <div class="chat-messages" id="chat-messages">
        <div class="message bot-message">
          Hello! How can I help you today?
        </div>
      </div>
      <div class="chat-input">
        <form id="message-form">
          <input type="text" id="message-input" class="text-base" placeholder="Type your message here...">
          <button type="submit">Send</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Hamburger menu for mobile -->
  <button class="hamburger hidden md:hidden" id="open-sidebar">â˜°</button>

  <script>
    // Dark mode detection
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });

    // Fixed updateAuthUI function with null checks
    function updateAuthUI(user) {
      const auth_reg = document.getElementById("auth_reg");
      const auth_logout = document.getElementById("auth_logout");
      const userEmail = document.getElementById("user-email");
      const alert_msg = document.getElementById("alert_msg");
      const authButtons = document.querySelector(".auth-buttons");
      const rdylogin = document.querySelector(".rdylogin");

      if (user) {
        if (userEmail) userEmail.textContent = "WELCOME ~ " + (user.name || user.email || "User");
        if (auth_logout) auth_logout.style.display = "block";
        if (auth_reg) auth_reg.style.display = "none";
        if (authButtons) authButtons.style.display = "none";
        if (rdylogin) rdylogin.style.display = "inline";
        if (alert_msg) alert_msg.style.display = "none";
      } else {
        if (userEmail) userEmail.textContent = "";
        if (auth_reg) auth_reg.style.display = "block";
        if (auth_logout) auth_logout.style.display = "none";
        if (authButtons) authButtons.style.display = "flex";
        if (rdylogin) rdylogin.style.display = "none";
        if (alert_msg) alert_msg.style.display = "flex";
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      const messageForm = document.getElementById("message-form");
      const messageInput = document.getElementById("message-input");
      const chatMessages = document.getElementById("chat-messages");
      const hamburgerButton = document.getElementById("open-sidebar");
      const sidebar = document.getElementById("sidebar");

      // Toggle sidebar on mobile
      if (hamburgerButton && sidebar) {
        hamburgerButton.addEventListener("click", () => {
          sidebar.classList.toggle("active");
        });
      }

      // Function to append a message
      function appendMessage(sender, content) {
        const messageElement = document.createElement("div");
        messageElement.className = `message ${sender}-message`;
        messageElement.innerHTML = content;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        return messageElement;
      }

      // Handle form submission 
      if (messageForm) {
        messageForm.addEventListener("submit", async (event) => {
          event.preventDefault();
          
          const userMessage = messageInput.value.trim();
          if (!userMessage) return;
          
          messageInput.value = "";
          
          // Display user message
          appendMessage("user", userMessage);
          
          // Show typing indicator
          const loadingIndicator = appendMessage(
            "bot", 
            '<div class="typing-indicator"><span></span><span></span><span></span></div>'
          );
          
          try {
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Remove loading indicator
            chatMessages.removeChild(loadingIndicator);
            
            // Add bot response using Poe API
            const promptText = "@Claude-3.7-Sonnet " + userMessage;
            
            // Register handler for bot responses
            const handlerId = "response-handler-" + Date.now();
            window.Poe.registerHandler(handlerId, (result) => {
              if (result.responses.length > 0) {
                const response = result.responses[0];
                
                if (response.status === "error") {
                  appendMessage("error-message", "Error: " + (response.statusText || "Unknown error"));
                } else if (response.status === "complete" || response.status === "incomplete") {
                  // For both complete and streaming incomplete responses
                  appendMessage("bot", response.content);
                  
                  // Scroll to bottom
                  chatMessages.scrollTop = chatMessages.scrollHeight;
                }
              }
            });
            
            // Send the message using Poe API
            await window.Poe.sendUserMessage(promptText, {
              handler: handlerId,
              stream: true,
              openChat: false
            });
            
          } catch (error) {
            console.error("Error:", error);
            appendMessage("error-message", "Sorry, there was an error processing your request.");
          }
        });
      }

      // Mock authentication for demo
      const mockUser = null; // Change to an object like {name: "Demo User"} to test logged-in state
      updateAuthUI(mockUser);
    });
  </script>


</body></html>